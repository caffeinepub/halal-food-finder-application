{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 3,
  "summary": "New project",
  "architectural_notes": [],
  "known_issues": [
    "Website location tracking appears unstable/unreliable in production",
    "Counter element/feature is missing on the website (regression after v20 deployment)"
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-reduce-perceived-instability-in-location-detection-and-tracking-by-preventing-conflicting-location-workflows-and-by-throttling-reducing-noisy-updates-context-the-app-supports-one-time-gps-detection-with-gps-ip-fallback-and-continuous-tracking-via-watchposition-users-report-that-web-site-location-unstable-implement-the-following-behaviors-if-continuous-tracking-is-active-disable-or-clearly-gate-the-one-time-detect-my-location-flow-so-the-two-mechanisms-do-not-compete-add-throttling-debouncing-to-continuous-tracking-triggered-searches-so-location-based-searches-are-not-triggered-too-frequently-even-when-coordinates-jitter-keep-the-existing-significant-change-check-but-also-enforce-a-minimum-time-interval-between-searches-reduce-user-facing-noise-avoid-firing-a-success-toast-on-every-tracking-update-only-toast-on-tracking-start-stop-and-on-meaningful-state-changes-e-g-first-fix-acquired-permission-denied-tracking-error-ensure-tracking-can-recover-cleanly-from-transient-errors-if-watchposition-emits-a-timeout-position-unavailable-error-reflect-it-in-ui-state-without-leaving-the-app-stuck-in-an-in-flight-state-and-allow-the-user-to-stop-restart-tracking",
      "title": "Reduce perceived instability in location detection and tracking by preventing conflicting location workflows and by throttling/reducing noisy updates.\n\nContext: The app supports one-time GPS detection (with GPS->IP fallback) and continuous tracking via `watchPosition`. Users report that “web site location unstable”.\n\nImplement the following behaviors:\n- If continuous tracking is active, disable or clearly gate the one-time “Detect My Location” flow so the two mechanisms do not compete.\n- Add throttling/debouncing to continuous tracking-triggered searches so location-based searches are not triggered too frequently even when coordinates jitter; keep the existing “significant change” check but also enforce a minimum time interval between searches.\n- Reduce user-facing noise: avoid firing a success toast on every tracking update; only toast on tracking start/stop and on meaningful state changes (e.g., first fix acquired, permission denied, tracking error).\n- Ensure tracking can recover cleanly from transient errors: if `watchPosition` emits a TIMEOUT/POSITION_UNAVAILABLE error, reflect it in UI state without leaving the app stuck in an in-flight state, and allow the user to stop/restart tracking.",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-restore-and-harden-the-visit-counter-so-it-is-visible-even-when-backend-calls-fail-and-provide-a-clear-fallback-ui-context-app-tsx-fetches-totalvisits-via-usetrafficcounter-and-passes-values-to-footer-but-the-footer-currently-hides-the-counter-entirely-when-countererror-is-true-implement-the-following-always-render-a-total-visits-row-in-the-footer-if-the-counter-fails-show-a-non-blocking-fallback-such-as-total-visits-unavailable-english-text-add-a-lightweight-retry-strategy-on-the-frontend-for-the-counter-fetch-increment-e-g-one-retry-after-a-short-delay-so-transient-actor-network-failures-in-production-don-t-permanently-hide-the-counter-for-the-session-keep-the-rest-of-the-app-functional-even-if-the-counter-fails-no-hard-errors",
      "title": "Restore and harden the visit counter so it is visible even when backend calls fail, and provide a clear fallback UI.\n\nContext: `App.tsx` fetches `totalVisits` via `useTrafficCounter()` and passes values to `Footer`, but the footer currently hides the counter entirely when `counterError` is true.\n\nImplement the following:\n- Always render a “Total visits” row in the footer. If the counter fails, show a non-blocking fallback such as “Total visits: unavailable” (English text).\n- Add a lightweight retry strategy on the frontend for the counter fetch/increment (e.g., one retry after a short delay) so transient actor/network failures in production don’t permanently hide the counter for the session.\n- Keep the rest of the app functional even if the counter fails (no hard errors).",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-3",
      "summary": "Persist the page view counter across future backend upgrades.\n\nContext: `backend/main.mo` stores `pageViews` in a non-stable variable, which will reset on canister upgrade.\n\nUpdate the backend so:\n- The page view counter value is stored in stable canister state so it survives future upgrades.\n- `incrementPageViews()` and `getPageViews()` continue to work with the same signatures.",
      "reqIds": [
        "REQ-3"
      ],
      "status": "pending"
    }
  ],
  "projectName": "Stabilize location detection and restore visit counter display",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}